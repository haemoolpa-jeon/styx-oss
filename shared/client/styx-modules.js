(function(){"use strict";var fe,me;const Q=location.hostname==="localhost"||location.hostname==="127.0.0.1",y=(...e)=>Q&&console.log(...e),m=e=>document.getElementById(e),N=window.STYX_SERVER_URL||"",Y=()=>!!(navigator.userAgent.includes("Tauri")||typeof window.__TAURI__<"u"||typeof window.__TAURI_INTERNALS__<"u"||location.protocol==="tauri:"),v=Y(),f=v&&((me=(fe=window.__TAURI__)==null?void 0:fe.core)==null?void 0:me.invoke)||null,a={currentUser:null,myRole:"performer",currentRoomSettings:{},isRoomCreator:!1,roomCreatorUsername:"",localStream:null,processedStream:null,isMuted:!1,selectedDeviceId:null,selectedOutputId:null,peers:new Map,volumeStates:new Map,isRecording:!1,mediaRecorder:null,recordedChunks:[],multitrackMode:localStorage.getItem("styx-multitrack")==="true",loopbackMode:localStorage.getItem("styx-loopback")==="true",proMode:localStorage.getItem("styx-pro-mode")==="true",lowLatencyMode:localStorage.getItem("styx-low-latency")==="true",autoJitter:localStorage.getItem("styx-auto-jitter")!=="false",vadEnabled:localStorage.getItem("styx-vad")!=="false",duckingEnabled:localStorage.getItem("styx-ducking")==="true"},ge=Object.freeze(Object.defineProperty({__proto__:null,$:m,DEBUG:Q,actuallyTauri:v,avatarUrl:e=>e?e.startsWith("/")?N+e:e:"",downloadBlob:(e,t)=>{const n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click(),URL.revokeObjectURL(n.href)},escapeHtml:e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},formatTime:e=>{const t=Math.floor(e/1e3);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`},isTauriApp:Y,log:y,serverUrl:N,state:a,tauriInvoke:f},Symbol.toStringTag,{value:"Module"}));function b(e,t="info",n=3e3){const o=m("toast-container");if(!o)return;const r=document.createElement("div");r.className=`toast ${t}`,r.textContent=e,o.appendChild(r),setTimeout(()=>{r.classList.add("hide"),setTimeout(()=>r.remove(),300)},n)}function he(){const e=localStorage.getItem("styx-theme")||"dark";document.body.dataset.theme=e,X()}function ye(){const t=document.body.dataset.theme==="dark"?"light":"dark";document.body.dataset.theme=t,localStorage.setItem("styx-theme",t),X()}function X(){const e=m("themeBtn");e&&(e.textContent=document.body.dataset.theme==="dark"?"â˜€ï¸":"ğŸŒ™")}function be(e){const t=m(e);t&&t.classList.remove("hidden")}function Se(e){const t=m(e);t&&t.classList.add("hidden")}let z=0;function Z(e=1){z=e;const t=m("reconnect-overlay");if(!t)return;t.classList.remove("hidden");const n=m("reconnect-count");n&&(n.textContent=e);const o=e/10*100,r=t.querySelector(".progress-bar");r&&(r.style.width=o+"%")}function ee(){const e=m("reconnect-overlay");if(!e||e.classList.contains("hidden"))return;const t=z/10*100,n=e.querySelector(".progress-bar");n&&(n.style.width=t+"%")}function F(){const e=m("reconnect-overlay");e&&e.classList.add("hidden"),z=0}function ve(){const e=m("muteBtn");e&&(e.textContent=a.isMuted?"ğŸ”‡":"ğŸ¤",e.classList.toggle("muted",a.isMuted))}function we(e=0,t=0,n=null){const o=m("quality-indicator");if(!o)return;let r="good";(e>30||t>5)&&(r="fair"),(e>50||t>10)&&(r="poor"),o.className=`quality-indicator ${r}`;let c=`Jitter: ${e.toFixed(1)}ms
Packet Loss: ${t.toFixed(1)}%`;n!==null&&(c+=`
E2E Latency: ${n}ms`),o.title=c;const i=o.querySelector(".latency-text");i&&n!==null&&(i.textContent=`${n}ms`)}const xe=Object.freeze(Object.defineProperty({__proto__:null,hideModal:Se,hideReconnectProgress:F,initTheme:he,showModal:be,showReconnectProgress:Z,toast:b,toggleTheme:ye,updateMuteUI:ve,updateQualityIndicator:we,updateReconnectProgress:ee},Symbol.toStringTag,{value:"Module"})),H={theme:"styx-theme",audioMode:"styx-audio-mode",jitterBuffer:"styx-jitter-buffer",autoJitter:"styx-auto-jitter",lowLatency:"styx-low-latency",proMode:"styx-pro-mode",echo:"styx-echo",noise:"styx-noise",aiNoise:"styx-ai-noise",ptt:"styx-ptt",pttKey:"styx-ptt-key",ducking:"styx-ducking",vad:"styx-vad",autoAdapt:"styx-auto-adapt",multitrack:"styx-multitrack",loopback:"styx-loopback",effects:"styx-effects",noiseProfile:"styx-noise-profile",customPresets:"styx-custom-presets",roomTemplates:"styx-room-templates",accessibility:"styx-accessibility",qualityLevel:"styx-quality-level"},K={audioMode:"balanced",jitterBuffer:5,autoJitter:!0,lowLatency:!1,proMode:!1,echo:!0,noise:!0,aiNoise:!1,ptt:!1,pttKey:"Space",ducking:!1,vad:!0,autoAdapt:!0,multitrack:!1,loopback:!1,qualityLevel:"auto",effects:{eqLow:0,eqMid:0,eqHigh:0,inputVolume:120,compressionRatio:4}};function l(e,t=null){try{const n=localStorage.getItem(H[e]||e);if(n===null)return t??K[e];if(n==="true")return!0;if(n==="false")return!1;const o=Number(n);if(!isNaN(o)&&n.trim()!=="")return o;try{return JSON.parse(n)}catch{return n}}catch(n){return y("Settings load error:",e,n),t??K[e]}}function p(e,t){try{const n=H[e]||e;typeof t=="object"?localStorage.setItem(n,JSON.stringify(t)):localStorage.setItem(n,String(t))}catch(n){y("Settings save error:",e,n)}}function Me(e){localStorage.removeItem(H[e]||e)}function te(){a.proMode=l("proMode"),a.lowLatencyMode=l("lowLatency"),a.autoJitter=l("autoJitter"),a.vadEnabled=l("vad"),a.duckingEnabled=l("ducking"),a.multitrackMode=l("multitrack"),a.loopbackMode=l("loopback")}function Re(){return{audioMode:l("audioMode"),jitterBuffer:l("jitterBuffer"),autoAdapt:l("autoAdapt"),echoCancellation:l("echo"),noiseSuppression:l("noise"),aiNoiseCancellation:l("aiNoise"),pttMode:l("ptt"),pttKey:l("pttKey"),duckingEnabled:l("ducking"),vadEnabled:l("vad"),theme:l("theme")||"dark"}}function ke(e){e&&(e.audioMode&&p("audioMode",e.audioMode),e.jitterBuffer!==void 0&&p("jitterBuffer",e.jitterBuffer),e.autoAdapt!==void 0&&p("autoAdapt",e.autoAdapt),e.echoCancellation!==void 0&&p("echo",e.echoCancellation),e.noiseSuppression!==void 0&&p("noise",e.noiseSuppression),e.aiNoiseCancellation!==void 0&&p("aiNoise",e.aiNoiseCancellation),e.pttMode!==void 0&&p("ptt",e.pttMode),e.pttKey&&p("pttKey",e.pttKey),e.duckingEnabled!==void 0&&p("ducking",e.duckingEnabled),e.vadEnabled!==void 0&&p("vad",e.vadEnabled),e.theme&&(p("theme",e.theme),document.documentElement.setAttribute("data-theme",e.theme)),te())}const _e={voice:{eqLow:-3,eqMid:2,eqHigh:1,inputVolume:130,compressionRatio:6},instrument:{eqLow:0,eqMid:0,eqHigh:0,inputVolume:100,compressionRatio:2},podcast:{eqLow:-2,eqMid:3,eqHigh:2,inputVolume:140,compressionRatio:5}};function Le(){const e=l("customPresets")||{};return{..._e,...e}}function qe(e,t){const n=l("customPresets")||{};n[e]=t,p("customPresets",n)}function Ue(e){const t=l("customPresets")||{};delete t[e],p("customPresets",t)}function V(){return l("roomTemplates")||{}}function Te(e,t){const n=V();n[e]=t,p("roomTemplates",n)}function Ce(e){const t=V();delete t[e],p("roomTemplates",t)}function ne(){return l("effects")||K.effects}function oe(e){p("effects",e)}function G(){return l("noiseProfile")||{baselineLevel:-60,adaptiveThreshold:-45}}function J(e){p("noiseProfile",e)}const Ee=Object.freeze(Object.defineProperty({__proto__:null,applySettings:ke,collectSettings:Re,deleteCustomPreset:Ue,deleteRoomTemplate:Ce,getEffects:ne,getNoiseProfile:G,getPresets:Le,getRoomTemplates:V,getSetting:l,loadAllSettings:te,removeSetting:Me,saveCustomPreset:qe,saveRoomTemplate:Te,setEffects:oe,setNoiseProfile:J,setSetting:p},Symbol.toStringTag,{value:"Module"}));let U=null;function E(){return(!U||U.state==="closed")&&(U=new AudioContext({latencyHint:"interactive",sampleRate:48e3})),U.state==="suspended"&&U.resume(),U}let w={},A=null,k=ne();async function Ae(e){if(a.proMode)return a.processedStream=e,w={},e;const t=E(),n=t.createMediaStreamSource(e),o=t.createBiquadFilter();o.type="lowshelf",o.frequency.value=320,o.gain.value=k.eqLow;const r=t.createBiquadFilter();r.type="peaking",r.frequency.value=1e3,r.Q.value=1,r.gain.value=k.eqMid;const c=t.createBiquadFilter();c.type="highshelf",c.frequency.value=3200,c.gain.value=k.eqHigh;let i=c;const u=G();try{await t.audioWorklet.addModule("noise-gate-processor.js"),A=new AudioWorkletNode(t,"noise-gate-processor");const R=A.parameters.get("threshold");R&&(R.value=u.adaptiveThreshold>-60?u.adaptiveThreshold:-45),c.connect(A),i=A}catch(R){y("Noise gate worklet failed:",R)}const d=t.createDynamicsCompressor();d.threshold.value=-12,d.knee.value=6,d.ratio.value=k.compressionRatio||4,d.attack.value=.003,d.release.value=.1;const h=t.createGain();h.gain.value=k.inputVolume/100;const s=t.createMediaStreamDestination();return n.connect(o),o.connect(r),r.connect(c),i.connect(d),d.connect(h),h.connect(s),w={eqLow:o,eqMid:r,eqHigh:c,compressor:d,makeupGain:h,noiseGate:A},a.processedStream=s.stream,a.processedStream}function ae(e,t){if(k[e]=t,oe(k),!!w.eqLow)switch(e){case"eqLow":w.eqLow.gain.value=t;break;case"eqMid":w.eqMid.gain.value=t;break;case"eqHigh":w.eqHigh.gain.value=t;break;case"inputVolume":w.makeupGain&&(w.makeupGain.gain.value=t/100);break;case"compressionRatio":w.compressor&&(w.compressor.ratio.value=t),a.peers.forEach(n=>{n.compressor&&(n.compressor.ratio.value=t)});break}}let x=null,P=null,L=null,j=null,B=!1;function Pe(){P=m("spectrum-canvas"),P&&(L=P.getContext("2d"))}function $e(){B=!B;const e=m("spectrum-container");B?(e==null||e.classList.remove("hidden"),a.localStream&&je()):(e==null||e.classList.add("hidden"),Be())}function je(){if(!a.localStream||!L)return;const e=E();x=e.createAnalyser(),x.fftSize=256,x.smoothingTimeConstant=.8,e.createMediaStreamSource(a.localStream).connect(x),re()}function Be(){if(j&&(cancelAnimationFrame(j),j=null),x){try{x.disconnect()}catch{}x=null}}function re(){if(!B||!x||!L)return;const e=x.frequencyBinCount,t=new Uint8Array(e);x.getByteFrequencyData(t);const n=P.width,o=P.height;L.fillStyle="rgba(0, 0, 0, 0.2)",L.fillRect(0,0,n,o);const r=n/e*2;let c=0;for(let i=0;i<e;i++){const u=t[i]/255*o,d=i/e*240;L.fillStyle=`hsl(${d}, 70%, 50%)`,L.fillRect(c,o-u,r,u),c+=r+1}j=requestAnimationFrame(re)}let I=null,_=null;function Ie(){if(!a.localStream)return;const e=E();_=e.createAnalyser(),_.fftSize=256,e.createMediaStreamSource(a.localStream).connect(_);const n=new Uint8Array(_.frequencyBinCount);I=setInterval(()=>{_.getByteFrequencyData(n);let o=0;for(let u=0;u<n.length;u++)o+=n[u];const r=o/n.length,c=Math.min(100,r/128*100),i=m("audio-meter-fill");i&&(i.style.width=c+"%")},50)}function Oe(){if(I&&(clearInterval(I),I=null),_){try{_.disconnect()}catch{}_=null}}let S=G();function De(){if(!a.localStream)return;S.isLearning=!0,S.learningData=[];const e=m("learn-noise");e&&(e.textContent="í•™ìŠµì¤‘...",e.disabled=!0);const t=E(),n=t.createAnalyser();n.fftSize=256,n.smoothingTimeConstant=.3,t.createMediaStreamSource(a.localStream).connect(n);const r=new Uint8Array(n.frequencyBinCount);let c=0;const i=()=>{if(!S.isLearning)return;n.getByteFrequencyData(r);let u=0;for(let s=0;s<r.length;s++)u+=r[s]*r[s];const d=Math.sqrt(u/r.length),h=20*Math.log10(d/255);S.learningData.push(h),c++,c<30?setTimeout(i,100):Ne(n)};i()}function Ne(e){if(S.isLearning=!1,S.learningData.length>0){const n=S.learningData.sort((c,i)=>c-i),o=n[Math.floor(n.length/2)],r=n[Math.floor(n.length*.75)];S.baselineLevel=o,S.adaptiveThreshold=Math.max(o+10,r+5),J({baselineLevel:S.baselineLevel,adaptiveThreshold:S.adaptiveThreshold}),b(`ë…¸ì´ì¦ˆ í”„ë¡œíŒŒì¼ í•™ìŠµ ì™„ë£Œ (${Math.round(S.baselineLevel)}dB)`,"success")}const t=m("learn-noise");t&&(t.textContent="í•™ìŠµ",t.disabled=!1);try{e.disconnect()}catch{}}function ze(){S={baselineLevel:-60,adaptiveThreshold:-45,learningData:[],isLearning:!1},J({baselineLevel:-60,adaptiveThreshold:-45}),b("ë…¸ì´ì¦ˆ í”„ë¡œíŒŒì¼ ë¦¬ì…‹","info")}function Fe(e){e&&Object.entries(e).forEach(([t,n])=>{k[t]=n,ae(t,n);const r=m({eqLow:"eq-low",eqMid:"eq-mid",eqHigh:"eq-high",inputVolume:"input-volume",compressionRatio:"compression-ratio"}[t]);r&&(r.value=n,r.nextElementSibling&&(r.nextElementSibling.textContent=t==="compressionRatio"?`${n}:1`:t==="inputVolume"?`${n}%`:`${n}dB`))})}const He=Object.freeze(Object.defineProperty({__proto__:null,applyAudioPreset:Fe,createProcessedInputStream:Ae,getSharedAudioContext:E,initSpectrum:Pe,resetNoiseProfile:ze,startAudioMeter:Ie,startNoiseLearning:De,stopAudioMeter:Oe,toggleSpectrum:$e,updateInputEffect:ae},Symbol.toStringTag,{value:"Module"}));let g=null,M=new Map,T=[],ie=0;function ce(e){const t=Math.floor(e/1e3);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`}function O(e,t){const n=new Blob(e,{type:"audio/webm"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`styx-${t}.webm`,o.click(),URL.revokeObjectURL(o.href)}function Ke(e){if(T.length===0)return;const t=T.map(r=>`${ce(r.time)}	${r.label}`).join(`
`),n=new Blob([t],{type:"text/plain"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`${e}_markers.txt`,o.click(),URL.revokeObjectURL(o.href)}function Ve(e=""){if(!a.isRecording)return;const t=Date.now()-ie,n={time:t,label:e||`Marker ${T.length+1}`};T.push(n),b(`ë§ˆì»¤ ì¶”ê°€: ${ce(t)}`,"info",1500)}function se(){if(a.isRecording)return;const e=new Date().toISOString().slice(0,19).replace(/:/g,"-");if(T=[],ie=Date.now(),a.multitrackMode){if(M.clear(),a.localStream){const t=new MediaRecorder(a.localStream,{mimeType:"audio/webm"}),n=[];t.ondataavailable=o=>{o.data.size>0&&n.push(o.data)},t.onstop=()=>O(n,`${e}_${a.currentUser.username}_local`),t.start(),M.set("local",{recorder:t,chunks:n,username:a.currentUser.username})}a.peers.forEach((t,n)=>{var o;if((o=t.audioEl)!=null&&o.srcObject){const r=new MediaRecorder(t.audioEl.srcObject,{mimeType:"audio/webm"}),c=[];r.ondataavailable=i=>{i.data.size>0&&c.push(i.data)},r.onstop=()=>O(c,`${e}_${t.username}`),r.start(),M.set(n,{recorder:r,chunks:c,username:t.username})}}),b(`ë©€í‹°íŠ¸ë™ ë…¹ìŒ ì‹œì‘ (${M.size}ê°œ íŠ¸ë™)`,"info")}else if(a.loopbackMode){g=new AudioContext;const t=g.createMediaStreamDestination();a.peers.forEach(n=>{var o;(o=n.audioEl)!=null&&o.srcObject&&g.createMediaStreamSource(n.audioEl.srcObject).connect(t)}),a.recordedChunks=[],a.mediaRecorder=new MediaRecorder(t.stream,{mimeType:"audio/webm"}),a.mediaRecorder.ondataavailable=n=>{n.data.size>0&&a.recordedChunks.push(n.data)},a.mediaRecorder.onstop=()=>{g&&(g.close().catch(()=>{}),g=null),O(a.recordedChunks,`${e}_loopback`)},a.mediaRecorder.start(),b("ë£¨í”„ë°± ë…¹ìŒ ì‹œì‘","info")}else{g=new AudioContext;const t=g.createMediaStreamDestination();a.localStream&&g.createMediaStreamSource(a.localStream).connect(t),a.peers.forEach(n=>{var o;(o=n.audioEl)!=null&&o.srcObject&&g.createMediaStreamSource(n.audioEl.srcObject).connect(t)}),a.recordedChunks=[],a.mediaRecorder=new MediaRecorder(t.stream,{mimeType:"audio/webm"}),a.mediaRecorder.ondataavailable=n=>{n.data.size>0&&a.recordedChunks.push(n.data)},a.mediaRecorder.onstop=()=>{g&&(g.close().catch(()=>{}),g=null),O(a.recordedChunks,`${e}_mix`)},a.mediaRecorder.start(),b("ë…¹ìŒ ì‹œì‘","info")}a.isRecording=!0,ue(!0)}function le(){if(!a.isRecording)return;const e=new Date().toISOString().slice(0,19).replace(/:/g,"-");a.multitrackMode&&M.size>0?(M.forEach(({recorder:t})=>t.stop()),M.clear(),b("ë©€í‹°íŠ¸ë™ ë…¹ìŒ ì™„ë£Œ","success")):a.mediaRecorder&&(a.mediaRecorder.stop(),b("ë…¹ìŒ ì™„ë£Œ","success")),T.length>0&&Ke(`styx-${e}`),a.isRecording=!1,ue(!1)}function Ge(){a.isRecording?le():se()}function Je(){a.isRecording&&(a.multitrackMode?(M.forEach(({recorder:e})=>{try{e.stop()}catch{}}),M.clear()):a.mediaRecorder&&a.mediaRecorder.stop()),g&&(g.close().catch(()=>{}),g=null),a.isRecording=!1}function ue(e){const t=m("recordBtn");t&&(t.textContent=e?"â¹ï¸ ë…¹ìŒ ì¤‘":"âºï¸ ë…¹ìŒ",t.classList.toggle("recording",e))}function We(e,t=4){const o=60/e,r=t*4,c=Math.ceil(r*o*48e3),i=new OfflineAudioContext(1,c,48e3);for(let u=0;u<r;u++){const d=i.createOscillator(),h=i.createGain();d.frequency.value=u%4===0?1e3:800,h.gain.value=.5,d.connect(h),h.connect(i.destination);const s=u*o;d.start(s),d.stop(s+.05)}i.startRendering().then(u=>{const d=Qe(u),h=new Blob([d],{type:"audio/wav"}),s=document.createElement("a");s.href=URL.createObjectURL(h),s.download=`click-${e}bpm-${t}bars.wav`,s.click(),URL.revokeObjectURL(s.href),b("í´ë¦­ íŠ¸ë™ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ","success")})}function Qe(e){const t=e.numberOfChannels,n=e.sampleRate,o=1,r=16,c=r/8,i=t*c,u=e.length*i,d=44+u,h=new ArrayBuffer(d),s=new DataView(h),R=($,C)=>{for(let D=0;D<C.length;D++)s.setUint8($+D,C.charCodeAt(D))};R(0,"RIFF"),s.setUint32(4,d-8,!0),R(8,"WAVE"),R(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,o,!0),s.setUint16(22,t,!0),s.setUint32(24,n,!0),s.setUint32(28,n*i,!0),s.setUint16(32,i,!0),s.setUint16(34,r,!0),R(36,"data"),s.setUint32(40,u,!0);const ut=e.getChannelData(0);let pe=44;for(let $=0;$<e.length;$++){const C=Math.max(-1,Math.min(1,ut[$]));s.setInt16(pe,C<0?C*32768:C*32767,!0),pe+=2}return h}const Ye=Object.freeze(Object.defineProperty({__proto__:null,addRecordingMarker:Ve,cleanupRecording:Je,exportClickTrack:We,startRecording:se,stopRecording:le,toggleRecording:Ge},Symbol.toStringTag,{value:"Module"})),q=io(N,{reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:10});q.io.on("reconnect_attempt",e=>Z(e)),q.io.on("reconnect_error",()=>ee()),q.io.on("reconnect_failed",()=>{F(),b("ì„œë²„ ì—°ê²° ì‹¤íŒ¨ - í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”","error",1e4)}),q.on("connect",()=>{y("Socket connected"),F()}),q.on("disconnect",e=>{y("Socket disconnected:",e),e==="io server disconnect"&&q.connect()});let de={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function Xe(e){e&&(de.iceServers=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:e.urls,username:e.username,credential:e.credential}],y("TURN credentials updated"))}async function Ze(){if(!v||!f)return{nat_type:"Unknown",public_addr:""};try{return await f("detect_nat")}catch(e){return y("NAT detection failed:",e),{nat_type:"Unknown",public_addr:""}}}async function et(e){if(!v||!f)return!1;try{return await f("attempt_p2p",{peerAddr:e})}catch(t){return y("P2P attempt failed:",t),!1}}let W=null;async function tt(e,t,n){if(!v||!f)return b("UDP ëª¨ë“œëŠ” ë°ìŠ¤í¬í†± ì•±ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤","warning"),!1;try{return W=await f("udp_bind",{port:0}),y("UDP bound to port:",W),await f("udp_set_relay",{host:e,port:t,sessionId:n}),await f("udp_start_relay_stream"),b("UDP ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì‹œì‘","success"),!0}catch(o){return y("UDP start failed:",o),b("UDP ì‹œì‘ ì‹¤íŒ¨: "+o,"error"),!1}}async function nt(){if(!(!v||!f))try{await f("udp_stop_stream"),W=null}catch(e){y("UDP stop error:",e)}}async function ot(e){if(!(!v||!f))try{await f("udp_set_muted",{muted:e})}catch(t){y("UDP mute error:",t)}}async function at(){if(!v||!f)return null;try{return await f("get_udp_stats")}catch{return null}}async function rt(){if(!v||!f)return null;try{return await f("measure_relay_latency")}catch{return null}}async function it(e){if(!(!v||!f))try{await f("set_bitrate",{bitrateKbps:e})}catch(t){y("Bitrate set error:",t)}}function ct(e,t,n){return e<50&&t<1&&n<10?"excellent":e<100&&t<3&&n<20?"good":e<200&&t<5&&n<40?"fair":"poor"}function st(e,t="balanced"){const n={"low-latency":{maxaveragebitrate:64e3,stereo:0,useinbandfec:0,usedtx:1,maxptime:10},balanced:{maxaveragebitrate:96e3,stereo:1,useinbandfec:1,usedtx:0,maxptime:20},"high-quality":{maxaveragebitrate:128e3,stereo:1,useinbandfec:1,usedtx:0,maxptime:40}},o=n[t]||n.balanced,r=`a=fmtp:111 minptime=10;maxptime=${o.maxptime};useinbandfec=${o.useinbandfec};usedtx=${o.usedtx};stereo=${o.stereo};maxaveragebitrate=${o.maxaveragebitrate}`;return e.replace(/a=fmtp:111[^\r\n]*/g,r)}const lt=Object.freeze(Object.defineProperty({__proto__:null,attemptP2P:et,detectNatType:Ze,getQualityGrade:ct,getUdpStats:at,measureRelayLatency:rt,optimizeOpusSdp:st,rtcConfig:de,setBitrate:it,setUdpMuted:ot,socket:q,startUdpMode:tt,stopUdpMode:nt,updateTurnCredentials:Xe},Symbol.toStringTag,{value:"Module"}));window.styxModules={core:ge,ui:xe,settings:Ee,audio:He,recording:Ye,network:lt}})();
