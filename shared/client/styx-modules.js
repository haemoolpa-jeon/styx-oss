(function(){"use strict";var fe,me;const Q=location.hostname==="localhost"||location.hostname==="127.0.0.1",y=(...e)=>Q&&console.log(...e),m=e=>document.getElementById(e),N=window.STYX_SERVER_URL||"",Y=()=>!!(navigator.userAgent.includes("Tauri")||typeof window.__TAURI__<"u"||typeof window.__TAURI_INTERNALS__<"u"||location.protocol==="tauri:"),v=Y(),f=v&&((me=(fe=window.__TAURI__)==null?void 0:fe.core)==null?void 0:me.invoke)||null,a={currentUser:null,myRole:"performer",currentRoomSettings:{},isRoomCreator:!1,roomCreatorUsername:"",localStream:null,processedStream:null,isMuted:!1,selectedDeviceId:null,selectedOutputId:null,peers:new Map,volumeStates:new Map,isRecording:!1,mediaRecorder:null,recordedChunks:[],multitrackMode:localStorage.getItem("styx-multitrack")==="true",loopbackMode:localStorage.getItem("styx-loopback")==="true",proMode:localStorage.getItem("styx-pro-mode")==="true",lowLatencyMode:localStorage.getItem("styx-low-latency")==="true",autoJitter:localStorage.getItem("styx-auto-jitter")!=="false",vadEnabled:localStorage.getItem("styx-vad")!=="false",duckingEnabled:localStorage.getItem("styx-ducking")==="true"},ge=Object.freeze(Object.defineProperty({__proto__:null,$:m,DEBUG:Q,actuallyTauri:v,avatarUrl:e=>e?e.startsWith("/")?N+e:e:"",downloadBlob:(e,t)=>{const o=document.createElement("a");o.href=URL.createObjectURL(e),o.download=t,o.click(),URL.revokeObjectURL(o.href)},escapeHtml:e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},formatTime:e=>{const t=Math.floor(e/1e3);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`},isTauriApp:Y,log:y,serverUrl:N,state:a,tauriInvoke:f},Symbol.toStringTag,{value:"Module"}));function b(e,t="info",o=3e3){const n=m("toast-container");if(!n)return;const r=document.createElement("div");r.className=`toast ${t}`,r.textContent=e,n.appendChild(r),setTimeout(()=>{r.classList.add("hide"),setTimeout(()=>r.remove(),300)},o)}function he(){const e=localStorage.getItem("styx-theme")||"dark";document.body.dataset.theme=e,X()}function ye(){const t=document.body.dataset.theme==="dark"?"light":"dark";document.body.dataset.theme=t,localStorage.setItem("styx-theme",t),X()}function X(){const e=m("themeBtn");e&&(e.textContent=document.body.dataset.theme==="dark"?"‚òÄÔ∏è":"üåô")}function be(e){const t=m(e);t&&t.classList.remove("hidden")}function Se(e){const t=m(e);t&&t.classList.add("hidden")}let z=0;function Z(e=1){z=e;const t=m("reconnect-overlay");if(!t)return;t.classList.remove("hidden");const o=m("reconnect-count");o&&(o.textContent=e);const n=e/10*100,r=t.querySelector(".progress-bar");r&&(r.style.width=n+"%")}function ee(){const e=m("reconnect-overlay");if(!e||e.classList.contains("hidden"))return;const t=z/10*100,o=e.querySelector(".progress-bar");o&&(o.style.width=t+"%")}function F(){const e=m("reconnect-overlay");e&&e.classList.add("hidden"),z=0}function ve(){const e=m("muteBtn");e&&(e.textContent=a.isMuted?"üîá":"üé§",e.classList.toggle("muted",a.isMuted))}function we(e=0,t=0,o=null){const n=m("quality-indicator");if(!n)return;let r="good";(e>30||t>5)&&(r="fair"),(e>50||t>10)&&(r="poor"),n.className=`quality-indicator ${r}`;let c=`Jitter: ${e.toFixed(1)}ms
Packet Loss: ${t.toFixed(1)}%`;o!==null&&(c+=`
E2E Latency: ${o}ms`),n.title=c;const i=n.querySelector(".latency-text");i&&o!==null&&(i.textContent=`${o}ms`)}const Me=Object.freeze(Object.defineProperty({__proto__:null,hideModal:Se,hideReconnectProgress:F,initTheme:he,showModal:be,showReconnectProgress:Z,toast:b,toggleTheme:ye,updateMuteUI:ve,updateQualityIndicator:we,updateReconnectProgress:ee},Symbol.toStringTag,{value:"Module"})),H={theme:"styx-theme",audioMode:"styx-audio-mode",jitterBuffer:"styx-jitter-buffer",autoJitter:"styx-auto-jitter",lowLatency:"styx-low-latency",proMode:"styx-pro-mode",echo:"styx-echo",noise:"styx-noise",aiNoise:"styx-ai-noise",ptt:"styx-ptt",pttKey:"styx-ptt-key",ducking:"styx-ducking",vad:"styx-vad",autoAdapt:"styx-auto-adapt",multitrack:"styx-multitrack",loopback:"styx-loopback",effects:"styx-effects",noiseProfile:"styx-noise-profile",customPresets:"styx-custom-presets",roomTemplates:"styx-room-templates",accessibility:"styx-accessibility",qualityLevel:"styx-quality-level"},K={audioMode:"balanced",jitterBuffer:5,autoJitter:!0,lowLatency:!1,proMode:!1,echo:!0,noise:!0,aiNoise:!1,ptt:!1,pttKey:"Space",ducking:!1,vad:!0,autoAdapt:!0,multitrack:!1,loopback:!1,qualityLevel:"auto",effects:{eqLow:0,eqMid:0,eqHigh:0,inputVolume:120,compressionRatio:4}};function l(e,t=null){try{const o=localStorage.getItem(H[e]||e);if(o===null)return t??K[e];if(o==="true")return!0;if(o==="false")return!1;const n=Number(o);if(!isNaN(n)&&o.trim()!=="")return n;try{return JSON.parse(o)}catch{return o}}catch(o){return y("Settings load error:",e,o),t??K[e]}}function p(e,t){try{const o=H[e]||e;typeof t=="object"?localStorage.setItem(o,JSON.stringify(t)):localStorage.setItem(o,String(t))}catch(o){y("Settings save error:",e,o)}}function xe(e){localStorage.removeItem(H[e]||e)}function te(){a.proMode=l("proMode"),a.lowLatencyMode=l("lowLatency"),a.autoJitter=l("autoJitter"),a.vadEnabled=l("vad"),a.duckingEnabled=l("ducking"),a.multitrackMode=l("multitrack"),a.loopbackMode=l("loopback")}function Re(){return{audioMode:l("audioMode"),jitterBuffer:l("jitterBuffer"),autoAdapt:l("autoAdapt"),echoCancellation:l("echo"),noiseSuppression:l("noise"),aiNoiseCancellation:l("aiNoise"),pttMode:l("ptt"),pttKey:l("pttKey"),duckingEnabled:l("ducking"),vadEnabled:l("vad"),theme:l("theme")||"dark"}}function ke(e){e&&(e.audioMode&&p("audioMode",e.audioMode),e.jitterBuffer!==void 0&&p("jitterBuffer",e.jitterBuffer),e.autoAdapt!==void 0&&p("autoAdapt",e.autoAdapt),e.echoCancellation!==void 0&&p("echo",e.echoCancellation),e.noiseSuppression!==void 0&&p("noise",e.noiseSuppression),e.aiNoiseCancellation!==void 0&&p("aiNoise",e.aiNoiseCancellation),e.pttMode!==void 0&&p("ptt",e.pttMode),e.pttKey&&p("pttKey",e.pttKey),e.duckingEnabled!==void 0&&p("ducking",e.duckingEnabled),e.vadEnabled!==void 0&&p("vad",e.vadEnabled),e.theme&&(p("theme",e.theme),document.documentElement.setAttribute("data-theme",e.theme)),te())}const _e={voice:{eqLow:-3,eqMid:2,eqHigh:1,inputVolume:130,compressionRatio:6},instrument:{eqLow:0,eqMid:0,eqHigh:0,inputVolume:100,compressionRatio:2},podcast:{eqLow:-2,eqMid:3,eqHigh:2,inputVolume:140,compressionRatio:5}};function Le(){const e=l("customPresets")||{};return{..._e,...e}}function qe(e,t){const o=l("customPresets")||{};o[e]=t,p("customPresets",o)}function Ue(e){const t=l("customPresets")||{};delete t[e],p("customPresets",t)}function V(){return l("roomTemplates")||{}}function Te(e,t){const o=V();o[e]=t,p("roomTemplates",o)}function Ce(e){const t=V();delete t[e],p("roomTemplates",t)}function oe(){return l("effects")||K.effects}function ne(e){p("effects",e)}function G(){return l("noiseProfile")||{baselineLevel:-60,adaptiveThreshold:-45}}function J(e){p("noiseProfile",e)}const Ee=Object.freeze(Object.defineProperty({__proto__:null,applySettings:ke,collectSettings:Re,deleteCustomPreset:Ue,deleteRoomTemplate:Ce,getEffects:oe,getNoiseProfile:G,getPresets:Le,getRoomTemplates:V,getSetting:l,loadAllSettings:te,removeSetting:xe,saveCustomPreset:qe,saveRoomTemplate:Te,setEffects:ne,setNoiseProfile:J,setSetting:p},Symbol.toStringTag,{value:"Module"}));let U=null;function E(){return(!U||U.state==="closed")&&(U=new AudioContext({latencyHint:"interactive",sampleRate:48e3})),U.state==="suspended"&&U.resume(),U}let w={},A=null,k=oe();async function Ae(e){if(a.proMode)return a.processedStream=e,w={},e;const t=E(),o=t.createMediaStreamSource(e),n=t.createBiquadFilter();n.type="lowshelf",n.frequency.value=320,n.gain.value=k.eqLow;const r=t.createBiquadFilter();r.type="peaking",r.frequency.value=1e3,r.Q.value=1,r.gain.value=k.eqMid;const c=t.createBiquadFilter();c.type="highshelf",c.frequency.value=3200,c.gain.value=k.eqHigh;let i=c;const u=G();try{await t.audioWorklet.addModule("noise-gate-processor.js"),A=new AudioWorkletNode(t,"noise-gate-processor");const R=A.parameters.get("threshold");R&&(R.value=u.adaptiveThreshold>-60?u.adaptiveThreshold:-45),c.connect(A),i=A}catch(R){y("Noise gate worklet failed:",R)}const d=t.createDynamicsCompressor();d.threshold.value=-12,d.knee.value=6,d.ratio.value=k.compressionRatio||4,d.attack.value=.003,d.release.value=.1;const h=t.createGain();h.gain.value=k.inputVolume/100;const s=t.createMediaStreamDestination();return o.connect(n),n.connect(r),r.connect(c),i.connect(d),d.connect(h),h.connect(s),w={eqLow:n,eqMid:r,eqHigh:c,compressor:d,makeupGain:h,noiseGate:A},a.processedStream=s.stream,a.processedStream}function ae(e,t){if(k[e]=t,ne(k),!!w.eqLow)switch(e){case"eqLow":w.eqLow.gain.value=t;break;case"eqMid":w.eqMid.gain.value=t;break;case"eqHigh":w.eqHigh.gain.value=t;break;case"inputVolume":w.makeupGain&&(w.makeupGain.gain.value=t/100);break;case"compressionRatio":w.compressor&&(w.compressor.ratio.value=t),a.peers.forEach(o=>{o.compressor&&(o.compressor.ratio.value=t)});break}}let M=null,P=null,L=null,j=null,B=!1;function Pe(){P=m("spectrum-canvas"),P&&(L=P.getContext("2d"))}function $e(){B=!B;const e=m("spectrum-container");B?(e==null||e.classList.remove("hidden"),a.localStream&&je()):(e==null||e.classList.add("hidden"),Be())}function je(){if(!a.localStream||!L)return;const e=E();M=e.createAnalyser(),M.fftSize=256,M.smoothingTimeConstant=.8,e.createMediaStreamSource(a.localStream).connect(M),re()}function Be(){if(j&&(cancelAnimationFrame(j),j=null),M){try{M.disconnect()}catch{}M=null}}function re(){if(!B||!M||!L)return;const e=M.frequencyBinCount,t=new Uint8Array(e);M.getByteFrequencyData(t);const o=P.width,n=P.height;L.fillStyle="rgba(0, 0, 0, 0.2)",L.fillRect(0,0,o,n);const r=o/e*2;let c=0;for(let i=0;i<e;i++){const u=t[i]/255*n,d=i/e*240;L.fillStyle=`hsl(${d}, 70%, 50%)`,L.fillRect(c,n-u,r,u),c+=r+1}j=requestAnimationFrame(re)}let I=null,_=null;function Ie(){if(!a.localStream)return;const e=E();_=e.createAnalyser(),_.fftSize=256,e.createMediaStreamSource(a.localStream).connect(_);const o=new Uint8Array(_.frequencyBinCount);I=setInterval(()=>{_.getByteFrequencyData(o);let n=0;for(let u=0;u<o.length;u++)n+=o[u];const r=n/o.length,c=Math.min(100,r/128*100),i=m("audio-meter-fill");i&&(i.style.width=c+"%")},50)}function Oe(){if(I&&(clearInterval(I),I=null),_){try{_.disconnect()}catch{}_=null}}let S=G();function De(){if(!a.localStream)return;S.isLearning=!0,S.learningData=[];const e=m("learn-noise");e&&(e.textContent="ÌïôÏäµÏ§ë...",e.disabled=!0);const t=E(),o=t.createAnalyser();o.fftSize=256,o.smoothingTimeConstant=.3,t.createMediaStreamSource(a.localStream).connect(o);const r=new Uint8Array(o.frequencyBinCount);let c=0;const i=()=>{if(!S.isLearning)return;o.getByteFrequencyData(r);let u=0;for(let s=0;s<r.length;s++)u+=r[s]*r[s];const d=Math.sqrt(u/r.length),h=20*Math.log10(d/255);S.learningData.push(h),c++,c<30?setTimeout(i,100):Ne(o)};i()}function Ne(e){if(S.isLearning=!1,S.learningData.length>0){const o=S.learningData.sort((c,i)=>c-i),n=o[Math.floor(o.length/2)],r=o[Math.floor(o.length*.75)];S.baselineLevel=n,S.adaptiveThreshold=Math.max(n+10,r+5),J({baselineLevel:S.baselineLevel,adaptiveThreshold:S.adaptiveThreshold}),b(`ÎÖ∏Ïù¥Ï¶à ÌîÑÎ°úÌååÏùº ÌïôÏäµ ÏôÑÎ£å (${Math.round(S.baselineLevel)}dB)`,"success")}const t=m("learn-noise");t&&(t.textContent="ÌïôÏäµ",t.disabled=!1);try{e.disconnect()}catch{}}function ze(){S={baselineLevel:-60,adaptiveThreshold:-45,learningData:[],isLearning:!1},J({baselineLevel:-60,adaptiveThreshold:-45}),b("ÎÖ∏Ïù¥Ï¶à ÌîÑÎ°úÌååÏùº Î¶¨ÏÖã","info")}function Fe(e){e&&Object.entries(e).forEach(([t,o])=>{k[t]=o,ae(t,o);const r=m({eqLow:"eq-low",eqMid:"eq-mid",eqHigh:"eq-high",inputVolume:"input-volume",compressionRatio:"compression-ratio"}[t]);r&&(r.value=o,r.nextElementSibling&&(r.nextElementSibling.textContent=t==="compressionRatio"?`${o}:1`:t==="inputVolume"?`${o}%`:`${o}dB`))})}const He=Object.freeze(Object.defineProperty({__proto__:null,applyAudioPreset:Fe,createProcessedInputStream:Ae,getSharedAudioContext:E,initSpectrum:Pe,resetNoiseProfile:ze,startAudioMeter:Ie,startNoiseLearning:De,stopAudioMeter:Oe,toggleSpectrum:$e,updateInputEffect:ae},Symbol.toStringTag,{value:"Module"}));let g=null,x=new Map,T=[],ie=0;function ce(e){const t=Math.floor(e/1e3);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`}function O(e,t){const o=new Blob(e,{type:"audio/webm"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download=`styx-${t}.webm`,n.click(),URL.revokeObjectURL(n.href)}function Ke(e){if(T.length===0)return;const t=T.map(r=>`${ce(r.time)}	${r.label}`).join(`
`),o=new Blob([t],{type:"text/plain"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download=`${e}_markers.txt`,n.click(),URL.revokeObjectURL(n.href)}function Ve(e=""){if(!a.isRecording)return;const t=Date.now()-ie,o={time:t,label:e||`Marker ${T.length+1}`};T.push(o),b(`ÎßàÏª§ Ï∂îÍ∞Ä: ${ce(t)}`,"info",1500)}function se(){if(a.isRecording)return;const e=new Date().toISOString().slice(0,19).replace(/:/g,"-");if(T=[],ie=Date.now(),a.multitrackMode){if(x.clear(),a.localStream){const t=new MediaRecorder(a.localStream,{mimeType:"audio/webm"}),o=[];t.ondataavailable=n=>{n.data.size>0&&o.push(n.data)},t.onstop=()=>O(o,`${e}_${a.currentUser.username}_local`),t.start(),x.set("local",{recorder:t,chunks:o,username:a.currentUser.username})}a.peers.forEach((t,o)=>{var n;if((n=t.audioEl)!=null&&n.srcObject){const r=new MediaRecorder(t.audioEl.srcObject,{mimeType:"audio/webm"}),c=[];r.ondataavailable=i=>{i.data.size>0&&c.push(i.data)},r.onstop=()=>O(c,`${e}_${t.username}`),r.start(),x.set(o,{recorder:r,chunks:c,username:t.username})}}),b(`Î©ÄÌã∞Ìä∏Îûô ÎÖπÏùå ÏãúÏûë (${x.size}Í∞ú Ìä∏Îûô)`,"info")}else if(a.loopbackMode){g=new AudioContext;const t=g.createMediaStreamDestination();a.peers.forEach(o=>{var n;(n=o.audioEl)!=null&&n.srcObject&&g.createMediaStreamSource(o.audioEl.srcObject).connect(t)}),a.recordedChunks=[],a.mediaRecorder=new MediaRecorder(t.stream,{mimeType:"audio/webm"}),a.mediaRecorder.ondataavailable=o=>{o.data.size>0&&a.recordedChunks.push(o.data)},a.mediaRecorder.onstop=()=>{g&&(g.close().catch(()=>{}),g=null),O(a.recordedChunks,`${e}_loopback`)},a.mediaRecorder.start(),b("Î£®ÌîÑÎ∞± ÎÖπÏùå ÏãúÏûë","info")}else{g=new AudioContext;const t=g.createMediaStreamDestination();a.localStream&&g.createMediaStreamSource(a.localStream).connect(t),a.peers.forEach(o=>{var n;(n=o.audioEl)!=null&&n.srcObject&&g.createMediaStreamSource(o.audioEl.srcObject).connect(t)}),a.recordedChunks=[],a.mediaRecorder=new MediaRecorder(t.stream,{mimeType:"audio/webm"}),a.mediaRecorder.ondataavailable=o=>{o.data.size>0&&a.recordedChunks.push(o.data)},a.mediaRecorder.onstop=()=>{g&&(g.close().catch(()=>{}),g=null),O(a.recordedChunks,`${e}_mix`)},a.mediaRecorder.start(),b("ÎÖπÏùå ÏãúÏûë","info")}a.isRecording=!0,ue(!0)}function le(){if(!a.isRecording)return;const e=new Date().toISOString().slice(0,19).replace(/:/g,"-");a.multitrackMode&&x.size>0?(x.forEach(({recorder:t})=>t.stop()),x.clear(),b("Î©ÄÌã∞Ìä∏Îûô ÎÖπÏùå ÏôÑÎ£å","success")):a.mediaRecorder&&(a.mediaRecorder.stop(),b("ÎÖπÏùå ÏôÑÎ£å","success")),T.length>0&&Ke(`styx-${e}`),a.isRecording=!1,ue(!1)}function Ge(){a.isRecording?le():se()}function Je(){a.isRecording&&(a.multitrackMode?(x.forEach(({recorder:e})=>{try{e.stop()}catch{}}),x.clear()):a.mediaRecorder&&a.mediaRecorder.stop()),g&&(g.close().catch(()=>{}),g=null),a.isRecording=!1}function ue(e){const t=m("recordBtn");t&&(t.textContent=e?"‚èπÔ∏è ÎÖπÏùå Ï§ë":"‚è∫Ô∏è ÎÖπÏùå",t.classList.toggle("recording",e))}function We(e,t=4){const n=60/e,r=t*4,c=Math.ceil(r*n*48e3),i=new OfflineAudioContext(1,c,48e3);for(let u=0;u<r;u++){const d=i.createOscillator(),h=i.createGain();d.frequency.value=u%4===0?1e3:800,h.gain.value=.5,d.connect(h),h.connect(i.destination);const s=u*n;d.start(s),d.stop(s+.05)}i.startRendering().then(u=>{const d=Qe(u),h=new Blob([d],{type:"audio/wav"}),s=document.createElement("a");s.href=URL.createObjectURL(h),s.download=`click-${e}bpm-${t}bars.wav`,s.click(),URL.revokeObjectURL(s.href),b("ÌÅ¥Î¶≠ Ìä∏Îûô ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏôÑÎ£å","success")})}function Qe(e){const t=e.numberOfChannels,o=e.sampleRate,n=1,r=16,c=r/8,i=t*c,u=e.length*i,d=44+u,h=new ArrayBuffer(d),s=new DataView(h),R=($,C)=>{for(let D=0;D<C.length;D++)s.setUint8($+D,C.charCodeAt(D))};R(0,"RIFF"),s.setUint32(4,d-8,!0),R(8,"WAVE"),R(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,n,!0),s.setUint16(22,t,!0),s.setUint32(24,o,!0),s.setUint32(28,o*i,!0),s.setUint16(32,i,!0),s.setUint16(34,r,!0),R(36,"data"),s.setUint32(40,u,!0);const ut=e.getChannelData(0);let pe=44;for(let $=0;$<e.length;$++){const C=Math.max(-1,Math.min(1,ut[$]));s.setInt16(pe,C<0?C*32768:C*32767,!0),pe+=2}return h}const Ye=Object.freeze(Object.defineProperty({__proto__:null,addRecordingMarker:Ve,cleanupRecording:Je,exportClickTrack:We,startRecording:se,stopRecording:le,toggleRecording:Ge},Symbol.toStringTag,{value:"Module"})),q=io(N,{reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:10});q.io.on("reconnect_attempt",e=>Z(e)),q.io.on("reconnect_error",()=>ee()),q.io.on("reconnect_failed",()=>{F(),b("ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå® - ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî","error",1e4)}),q.on("connect",()=>{y("Socket connected"),F()}),q.on("disconnect",e=>{y("Socket disconnected:",e),e==="io server disconnect"&&q.connect()});let de={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function Xe(e){e&&(de.iceServers=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:e.urls,username:e.username,credential:e.credential}],y("TURN credentials updated"))}async function Ze(){if(!v||!f)return{nat_type:"Unknown",public_addr:""};try{return await f("detect_nat")}catch(e){return y("NAT detection failed:",e),{nat_type:"Unknown",public_addr:""}}}async function et(e){if(!v||!f)return!1;try{return await f("attempt_p2p",{peerAddr:e})}catch(t){return y("P2P attempt failed:",t),!1}}let W=null;async function tt(e,t,o){if(!v||!f)return b("UDP Î™®ÎìúÎäî Îç∞Ïä§ÌÅ¨ÌÜ± Ïï±ÏóêÏÑúÎßå ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§","warning"),!1;try{return W=await f("udp_bind",{port:0}),y("UDP bound to port:",W),await f("udp_set_relay",{host:e,port:t,sessionId:o}),await f("udp_start_relay_stream"),b("UDP Ïò§ÎîîÏò§ Ïä§Ìä∏Î¶º ÏãúÏûë","success"),!0}catch(n){return y("UDP start failed:",n),b("UDP ÏãúÏûë Ïã§Ìå®: "+n,"error"),!1}}async function ot(){if(!(!v||!f))try{await f("udp_stop_stream"),W=null}catch(e){y("UDP stop error:",e)}}async function nt(e){if(!(!v||!f))try{await f("udp_set_muted",{muted:e})}catch(t){y("UDP mute error:",t)}}async function at(){if(!v||!f)return null;try{return await f("get_udp_stats")}catch{return null}}async function rt(){if(!v||!f)return null;try{return await f("measure_relay_latency")}catch{return null}}async function it(e){if(!(!v||!f))try{await f("set_bitrate",{bitrateKbps:e})}catch(t){y("Bitrate set error:",t)}}function ct(e,t,o){return t>5||e>200||o>50?{grade:"poor",label:"Î∂àÏïàÏ†ï",color:"#ff4757"}:t>2||e>100||o>30?{grade:"fair",label:"Î≥¥ÌÜµ",color:"#ffa502"}:{grade:"good",label:"Ï¢ãÏùå",color:"#2ed573"}}function st(e,t="balanced"){const o={"low-latency":{maxaveragebitrate:64e3,stereo:0,useinbandfec:0,usedtx:1,maxptime:10},balanced:{maxaveragebitrate:96e3,stereo:1,useinbandfec:1,usedtx:0,maxptime:20},"high-quality":{maxaveragebitrate:128e3,stereo:1,useinbandfec:1,usedtx:0,maxptime:40}},n=o[t]||o.balanced,r=`a=fmtp:111 minptime=10;maxptime=${n.maxptime};useinbandfec=${n.useinbandfec};usedtx=${n.usedtx};stereo=${n.stereo};maxaveragebitrate=${n.maxaveragebitrate}`;return e.replace(/a=fmtp:111[^\r\n]*/g,r)}const lt=Object.freeze(Object.defineProperty({__proto__:null,attemptP2P:et,detectNatType:Ze,getQualityGrade:ct,getUdpStats:at,measureRelayLatency:rt,optimizeOpusSdp:st,rtcConfig:de,setBitrate:it,setUdpMuted:nt,socket:q,startUdpMode:tt,stopUdpMode:ot,updateTurnCredentials:Xe},Symbol.toStringTag,{value:"Module"}));window.styxModules={core:ge,ui:Me,settings:Ee,audio:He,recording:Ye,network:lt}})();
