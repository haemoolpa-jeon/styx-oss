# 🎵 Styx v1.5.0

HADES를 위한 실시간 오디오 협업 플랫폼

## 🔴 v1.5.0 안정성 및 코드 품질 개선

### 🔧 코드 정리 및 버그 수정
- **중복 핸들러 제거** - 성능 모드 이벤트 핸들러 중복 등록 수정
- **Null safety 강화** - 제거된 UI 요소 참조에 대한 안전성 추가
- **Socket error 핸들러** - 서버 에러 이벤트 처리 추가
- **오디오 테스트 수정** - 제거된 로비 요소 대신 고급 패널 요소 참조
- **CSS 애니메이션** - 누락된 slide-in 애니메이션 추가

### 🎛️ 고급 설정 패널 완성
- **13개 설정 항목** - 오디오 처리, 통화 모드, 성능, 네트워크, 음질
- **실시간 적용** - 설정 변경 시 즉시 오디오 스트림 재시작
- **localStorage 동기화** - 모든 설정 자동 저장/복원

### 📊 연결 진단 개선
- **빈 데이터 처리** - 데이터 수집 전 안내 메시지 표시
- **차트 렌더링** - 지연시간/지터 시각화 안정화

---

## 🔴 v1.4.3 UI 간소화 및 수동 제어

### 🎛️ 새로운 고급 설정 패널
- **오디오 처리 토글** - 에코 제거, 노이즈 제거, AI 노이즈, 자동 음량
- **성능 모드** - 일반/저지연/Pro 모드 실시간 전환
- **음질 조절** - 48~192kbps 비트레이트 선택 (데스크톱)

### 🧹 UI 간소화
- **Room toolbar 정리** - 중복 옵션 제거, 핵심 기능만 유지
- **Effects panel 정리** - Spectrum, Spatial Audio, Routing 등 niche 기능 제거
- **~1,200줄 코드 제거** - 사용하지 않는 기능 정리
- **Tooltips 추가** - 모든 설정에 설명 추가

---

## 🔴 v1.4.2 안정성 및 품질 개선

### 🐛 버그 수정
- **버튼 클릭 문제 해결** - CSS pseudo-element 위치 문제로 인한 클릭 불가 수정
- **AudioContext 오류 수정** - "Cannot close a closed AudioContext" 오류 해결
- **SFU 모드 정리** - 방 퇴장 시 SFU 상태 초기화 추가
- **화면 공유 정리** - 방 퇴장 시 화면 공유 자동 종료
- **메모리 누수 수정** - 모든 Map/배열 정리 로직 보완

### 🛡️ 안정성 개선
- **Race condition 방지** - 동시 방 입장/오디오 재시작 방지
- **TCP 핸들러 누수 수정** - 소켓 핸들러 중복 등록 방지
- **Null 안전성** - DOM 요소 접근 시 optional chaining 추가
- **에러 핸들링** - 모든 async 함수에 try-catch 추가

### ⚠️ Windows 보안 경고 안내
데스크톱 앱 다운로드 시 Windows SmartScreen 또는 백신 프로그램에서 경고가 표시될 수 있습니다.
이는 앱이 아직 코드 서명되지 않아 발생하는 **오탐지(false positive)**입니다.

**해결 방법:**
1. Windows SmartScreen: "추가 정보" → "실행" 클릭
2. Windows Defender: 설정 → 바이러스 및 위협 방지 → 제외 추가
3. 기타 백신: 해당 파일을 예외 목록에 추가

> 앱의 안전성이 우려되시면 [소스 코드](https://github.com/haemoolpa-jeon/styx-oss)를 직접 확인하고 빌드하실 수 있습니다.

### 📊 예상 지연시간
| 연결 방식 | 지연시간 |
|-----------|----------|
| 같은 네트워크 | 5-15ms |
| UDP 릴레이 | 20-50ms |
| TURN 릴레이 | 50-100ms |

> 📖 **상세 릴리즈 노트**: [docs/release-notes/](docs/release-notes/)

---

## 🛡️ v1.3.0 보안 업데이트

**이번 릴리스는 8개의 중요한 보안 취약점을 수정한 필수 업데이트입니다.**

### 🛡️ 보안 강화
- **UDP 페이로드 검증** - 버퍼 오버런 공격 방지
- **정수 오버플로우 보호** - 안전한 데이터 처리
- **패킷 크기 검증** - 대용량 패킷 공격 차단
- **오디오 스트림 오류 처리** - 적절한 실패 신호 전송
- **메모리 안전성** - 안전한 메모리 작업으로 교체
- **네트워크 복원력** - 포괄적인 오류 처리 및 타임아웃

### 🔧 시스템 개선
- **bcrypt 암호 해싱** - 10 솔트 라운드 보안 강화
- **입력 검증** - Zod 스키마 기반 모든 입력 검증
- **속도 제한** - IP 기반 스로틀링 및 의심 활동 감지
- **감사 로깅** - 모든 보안 이벤트 기록
- **GDPR 준수** - 데이터 프라이버시 기능

## ✨ v1.2.0 주요 기능

### 🎵 고품질 오디오
- **스테레오 오디오** - 모노에서 스테레오로 업그레이드된 고품질 사운드
- **AI 노이즈 제거** - RNNoise WASM 기반 실시간 노이즈 제거
- **동적 범위 압축** - 사용자 간 자동 음량 균형 조절
- **3밴드 EQ** - 저음/중음/고음 조절
- **오디오 프리셋** - 음성/악기/팟캐스트 프리셋

### 🎛️ 전문 기능
- **향상된 키보드 단축키** - 20개 이상의 포괄적인 단축키 시스템
- **고급 오디오 이펙트** - 3밴드 EQ, 딜레이, 압축 효과
- **멀티트랙 녹음** - 각 참가자를 개별 파일로 녹음
- **화면 공유** - getDisplayMedia를 활용한 화면/악보 공유
- **역할 시스템** - 호스트/연주자/청취자 역할 구분

### 👥 사용자 관리
- **사용자 승인 시스템** - 관리자 승인 워크플로우로 향상된 보안
- **관리자 패널 강화** - 모니터링 및 로그 기능 추가
- **전문적인 사용자 관리** - 검색 및 제어 기능이 포함된 사용자 카드
- **자체 통계 표시** - 본인의 연결 상태 (지연시간, 대역폭, 패킷 손실) 확인

### 🔒 보안 및 성능
- **향상된 보안 로깅** - 모든 보안 이벤트에 대한 감사 추적
- **GDPR 준수** - 데이터 내보내기/삭제 기능으로 개인정보보호 강화
- **고급 속도 제한** - 의심스러운 IP 추적 및 자동 차단
- **상태 모니터링** - 메트릭 엔드포인트로 시스템 상태 실시간 확인
- **대역폭 적응** - 연결 품질에 따른 자동 품질 조절

### ♿ 접근성 및 사용자 경험
- **WCAG 2.1 AA 준수** - 스크린 리더 지원 및 접근성 개선
- **고대비 모드** - 시각 장애인을 위한 고대비 테마
- **전문적인 UI 개선** - 애니메이션 및 마이크로 인터랙션 추가
- **향상된 타이포그래피** - 개선된 글꼴 및 간격 시스템

## 기본 기능

### 오디오
- **🖥️ 데스크톱 앱**: UDP P2P 기반 초저지연 오디오 (권장)
- **🌐 웹 버전**: WebRTC P2P 기반 관전 모드
- **스테레오 오디오** - 고품질 스테레오 사운드
- **최대 8명** - 방당 최대 8명 동시 접속
- **개별 볼륨 조절** - 사용자별 볼륨/팬/뮤트/솔로
- **음성/음악 모드** - 용도에 맞는 오디오 최적화

### 네트워크
- **연결 테스트** - 마이크/스피커/네트워크 품질 측정
- **Wi-Fi 경고** - 유선 연결 권장 메시지
- **자동 지터 버퍼** - 네트워크 상태에 따라 자동 조절
- **연결 유형 표시** - 직접/STUN/TURN 연결 상태

### 메트로놈
- **공유 메트로놈** - 방 전체 BPM 동기화
- **서버 시간 동기화** - 정확한 박자 맞춤
- **카운트인** - 4박 카운트 후 시작

### 방 기능
- **방 브라우저** - 활성 방 목록
- **비공개 방** - 비밀번호 설정
- **채팅** - 방 내 텍스트 채팅

## 빠른 시작

### 🖥️ 데스크톱 앱 (권장)
1. **다운로드**: [Styx Desktop v1.4.1](https://github.com/haemoolpa-jeon/styx-oss/releases)
2. **설치**: `Styx_1.4.1_x64-setup.exe` 실행
3. **실행**: 설치된 Styx 앱 실행
4. **접속**: 서버 주소 입력 또는 기본 서버 사용

### 🌐 웹 버전 (관전 전용)
브라우저에서 https://3-39-223-2.nip.io 접속

### 🛠️ 서버 설치 (개발자용)
```bash
git clone https://github.com/haemoolpa-jeon/styx.git
cd styx
npm install
npm run setup    # 관리자 계정 생성
npm start        # 서버 시작
```

**기본 관리자**: `admin` / `admin123` (첫 로그인 후 변경 필수!)

## 서버 주소

- **웹**: https://3-39-223-2.nip.io
- **TURN**: 3.39.223.2:3478

## 키보드 단축키

### 기본 제어
| 키 | 기능 |
|----|------|
| M | 음소거 토글 |
| Space | 메트로놈 토글 |
| R | 녹음 토글 |
| B | 녹음 마커 추가 |
| I | 초대 링크 복사 |
| Esc | 방 나가기 |

### 오디오 제어
| 키 | 기능 |
|----|------|
| V | 음성 감지 토글 |
| T | 튜너 토글 |
| L | 저지연 모드 토글 |
| E | 에코 제거 토글 |
| N | 노이즈 억제 토글 |

### 볼륨 제어
| 키 | 기능 |
|----|------|
| ↑ | 마스터 볼륨 증가 |
| ↓ | 마스터 볼륨 감소 |
| ← | 입력 볼륨 감소 |
| → | 입력 볼륨 증가 |

### 피어 제어
| 키 | 기능 |
|----|------|
| 1-8 | 해당 피어 음소거 토글 |

### 전역 단축키
| 키 | 기능 |
|----|------|
| F1 또는 ? | 도움말 표시 |
| F11 | 전체화면 토글 |
| Ctrl+S | 설정 저장 |
| Ctrl+O | 설정 열기 |

### 접근성
| 키 | 기능 |
|----|------|
| Ctrl+Alt+H | 고대비 모드 |
| Ctrl+Alt+S | 스크린 리더 모드 |
| Ctrl+Alt+M | 애니메이션 감소 |

## 파일 구조

```
styx/
├── server/index.js       # 시그널링 서버
├── shared/client/        # 공유 클라이언트 코드
├── client/config.js      # 웹 버전 설정
├── styx-desktop/         # Tauri 데스크톱 앱
├── docs/                 # 문서
└── .env.example          # 환경변수 예시
```

## 아키텍처

### 🖥️ 데스크톱 앱 (Tauri) - 권장
```
┌─────────┐                           ┌─────────┐
│ User A  │◄──── UDP P2P 오디오 ──────►│ User B  │
│(Desktop)│                           │(Desktop)│
└────┬────┘                           └────┬────┘
     │                                      │
     │    ┌─────────────────────────┐      │
     └───►│   Styx 서버 (서울)       │◄─────┘
          │  • Socket.IO 시그널링    │
          │  • 방/채팅/메트로놈       │
          │  • UDP 피어 정보 교환    │
          └───────────┬─────────────┘
                      │
          ┌───────────▼─────────────┐
          │   UDP 릴레이 서버        │
          │  • 직접 P2P 우선        │
          │  • NAT 통과 지원        │
          │  • 저지연 오디오 전송    │
          └─────────────────────────┘
```

### 🌐 웹 버전 (관전 전용)
```
┌─────────┐                           ┌─────────┐
│ User A  │◄──── WebRTC P2P 오디오 ───►│ User B  │
│ (Web)   │                           │ (Web)   │
└────┬────┘                           └────┬────┘
     │                                      │
     │    ┌─────────────────────────┐      │
     └───►│   Styx 서버 (서울)       │◄─────┘
          │  • Socket.IO 시그널링    │
          │  • WebRTC 시그널링       │
          │  • TURN 자격증명 발급    │
          └─────────────────────────┘
```

**권장**: 음성 참여를 위해서는 **데스크톱 앱**을 사용하세요. 웹 버전은 관전 전용입니다.

## 문서

- [사용 설명서](docs/USER_MANUAL.md)
- [배포 가이드](docs/AWS_LIGHTSAIL_DEPLOY.md)
- [테스트 가이드](docs/TESTING_GUIDE.md)
- [HADES 소개](docs/HADES_STYX_소개.md)

## 오픈소스 라이선스

이 프로젝트는 다음 오픈소스 라이브러리를 사용합니다:

### Server (Node.js)
| 패키지 | 라이선스 | 용도 |
|--------|----------|------|
| [Express](https://expressjs.com/) | MIT | 웹 서버 프레임워크 |
| [Socket.IO](https://socket.io/) | MIT | 실시간 통신 |
| [bcrypt](https://github.com/kelektiv/node.bcrypt.js) | MIT | 비밀번호 해싱 |
| [Helmet](https://helmetjs.github.io/) | MIT | HTTP 보안 헤더 |
| [Zod](https://zod.dev/) | MIT | 스키마 검증 |
| [dotenv](https://github.com/motdotla/dotenv) | BSD-2-Clause | 환경변수 관리 |

### Desktop App (Rust/Tauri)
| 크레이트 | 라이선스 | 용도 |
|----------|----------|------|
| [Tauri](https://tauri.app/) | MIT/Apache-2.0 | 데스크톱 앱 프레임워크 |
| [Tokio](https://tokio.rs/) | MIT | 비동기 런타임 |
| [cpal](https://github.com/RustAudio/cpal) | Apache-2.0 | 오디오 I/O |
| [opus](https://crates.io/crates/opus) | MIT/Apache-2.0 | 오디오 코덱 |
| [Serde](https://serde.rs/) | MIT/Apache-2.0 | 직렬화 |

모든 라이브러리는 MIT, Apache-2.0, BSD 등 상업적 사용이 허용되는 라이선스입니다.

## 라이선스

HADES 전용 - 비공개 사용
