# Styx v1.4.0 릴리즈 노트

**릴리즈 날짜:** 2024-12-24

## 🎯 주요 변경사항

### TURN 서버 수정 (Critical)
- TURN 인증 문제 해결 - 이제 NAT/방화벽 뒤에서도 연결 가능
- 네트워크 테스트에서 TURN 상태 표시 추가
- 직접 연결 실패 시 자동으로 TURN 릴레이 사용

### 네트워크 테스트 개선
- 연결 상태를 더 명확하게 표시:
  - `✓ 직접 연결` - 최적의 지연시간
  - `✓ TURN 릴레이` - 연결 가능하지만 지연 증가
  - `✗ 연결 실패` - 방화벽 확인 필요

---

## 📊 예상 지연시간 (Latency)

| 연결 방식 | 예상 지연시간 | 사용 사례 |
|-----------|---------------|-----------|
| UDP 직접 (같은 네트워크) | 5-15ms | 같은 공유기 사용 |
| UDP 릴레이 (서버 경유) | 20-50ms | 일반적인 가정용 인터넷 |
| TURN 릴레이 | 50-100ms | NAT/방화벽 뒤 |
| TCP 폴백 | 80-150ms | UDP 완전 차단 시 |

### 지연시간에 영향을 주는 요소
- **물리적 거리**: 서버(서울 AWS)와의 거리
- **네트워크 품질**: 패킷 손실, 지터
- **NAT 유형**: Full Cone > Restricted > Symmetric
- **Wi-Fi vs 유선**: 유선 연결 권장 (10-20ms 개선)

---

## ⚠️ 알려진 문제 및 해결방법

### 1. 연결 테스트 실패
**증상:** 네트워크 테스트에서 "연결 실패" 표시

**원인 및 해결:**
| 원인 | 해결방법 |
|------|----------|
| 기업/학교 방화벽 | IT 부서에 UDP 5000, 3478 포트 허용 요청 |
| ISP 모뎀 직접 연결 | 공유기를 통해 연결 (NAT 필요) |
| Symmetric NAT | TURN 자동 사용됨 (지연 증가) |
| 모든 UDP 차단 | VPN 사용 또는 모바일 핫스팟 |

### 2. 오디오가 들리지 않음
**증상:** 연결은 되지만 상대방 소리가 안 들림

**해결:**
1. 출력 장치 확인 (설정 > 오디오 출력)
2. 볼륨 슬라이더 확인 (0%가 아닌지)
3. 브라우저 탭 음소거 해제
4. 방 나갔다가 다시 입장

### 3. 내 소리가 전송 안됨
**증상:** 마이크 레벨 미터가 움직이지 않음

**해결:**
1. 마이크 권한 허용 확인
2. 입력 장치 선택 확인
3. 음소거 버튼 확인 (🔇 → 🎤)
4. PTT 모드 확인 (Space 키 누르고 말하기)

### 4. 끊김/지연 심함
**증상:** 오디오가 끊기거나 지연이 큼

**해결:**
1. 유선 연결 사용
2. 지터 버퍼 증가 (설정 > 50-100ms)
3. 비트레이트 낮추기 (96k → 64k)
4. 다른 네트워크 시도

---

## 🧪 테스트 가이드

### 사전 요구사항
- Styx Desktop 앱 (Windows/Mac)
- 마이크 및 스피커/헤드폰
- 인터넷 연결

### 테스트 절차

#### 1단계: 연결 테스트
1. 앱 실행 후 로그인
2. 로비에서 `🔍 연결 테스트` 버튼 클릭
3. 결과 확인:
   - ✓ 마이크: 마이크 인식됨
   - ✓ 스피커: 비프음 들림
   - ✓ 서버 연결: 직접 연결 또는 TURN 릴레이

#### 2단계: 오디오 테스트
1. `🎤 마이크` 버튼 클릭
2. 말하면서 레벨 미터 확인
3. 레벨이 움직이면 정상

#### 3단계: 방 입장 테스트
1. 방 생성 또는 기존 방 입장
2. 상대방과 대화 테스트
3. 지연시간 확인 (우측 상단 통계)

#### 4단계: 기능 테스트
| 기능 | 테스트 방법 | 예상 결과 |
|------|-------------|-----------|
| 음소거 | M 키 또는 🎤 버튼 | 아이콘 변경, 상대방에게 안 들림 |
| 메트로놈 | ▶️ 버튼 | 모든 참가자에게 동기화된 박자 |
| 녹음 | ⏺️ 버튼 | 녹음 후 .webm 파일 다운로드 |
| 화면 공유 | 🖥️ 버튼 | 상대방에게 화면 표시 |

### 문제 발생 시
1. 브라우저 콘솔 (F12) 에러 확인
2. 서버 로그 확인: `pm2 logs styx`
3. GitHub Issue 등록

---

## 🔧 기술 스택

- **오디오 코덱:** Opus (48kHz, 스테레오, 64-128kbps)
- **전송:** UDP 릴레이 (서버 경유)
- **시그널링:** Socket.IO (WebSocket)
- **NAT 통과:** STUN + TURN (coturn)
- **데스크톱:** Tauri 2.0 + Rust
- **서버:** Node.js + AWS Lightsail

---

## 📝 이전 버전에서 업그레이드

v1.3.0에서 업그레이드 시:
1. 데스크톱 앱 재설치 (자동 업데이트 미지원)
2. 브라우저 캐시 삭제 (Ctrl+Shift+R)
3. 서버는 자동 배포됨

---

## 🙏 기여자

- HSJEON (개발)
- 피어 테스터들 (버그 리포트)

---

**다음 버전 예정 (v1.5.0):**
- TURN over TCP/443 (방화벽 우회 강화)
- 모바일 앱 (iOS/Android)
- SFU 모드 (대규모 방 지원)
